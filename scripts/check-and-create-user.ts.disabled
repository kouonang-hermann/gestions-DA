import { PrismaClient } from '@prisma/client'
import bcrypt from 'bcryptjs'
import crypto from 'crypto'

const prisma = new PrismaClient()

async function main() {
  console.log('ðŸ” VÃ©rification de l\'utilisateur avec le numÃ©ro 699425611...\n')

  // Rechercher l'utilisateur par numÃ©ro de tÃ©lÃ©phone
  const existingUser = await prisma.user.findFirst({
    where: {
      phone: '699425611'
    }
  })

  if (existingUser) {
    console.log('âœ… Utilisateur trouvÃ© :')
    console.log(`   Nom: ${existingUser.nom}`)
    console.log(`   PrÃ©nom: ${existingUser.prenom}`)
    console.log(`   Email: ${existingUser.email}`)
    console.log(`   TÃ©lÃ©phone: ${existingUser.phone}`)
    console.log(`   RÃ´le: ${existingUser.role}`)
    console.log(`   ID: ${existingUser.id}`)
  } else {
    console.log('âŒ Aucun utilisateur trouvÃ© avec le numÃ©ro 699425611\n')
    
    // Rechercher si un utilisateur avec le nom "Ndandoalfred" existe
    console.log('ðŸ” Recherche d\'utilisateurs avec le nom "Ndando" ou "Alfred"...\n')
    
    const usersWithName = await prisma.user.findMany({
      where: {
        OR: [
          { nom: { contains: 'Ndando', mode: 'insensitive' } },
          { nom: { contains: 'Alfred', mode: 'insensitive' } },
          { prenom: { contains: 'Ndando', mode: 'insensitive' } },
          { prenom: { contains: 'Alfred', mode: 'insensitive' } },
        ]
      }
    })

    if (usersWithName.length > 0) {
      console.log(`âœ… ${usersWithName.length} utilisateur(s) trouvÃ©(s) :`)
      usersWithName.forEach(user => {
        console.log(`   - ${user.prenom} ${user.nom} (${user.phone}) - ${user.role}`)
      })
    } else {
      console.log('âŒ Aucun utilisateur trouvÃ© avec ce nom\n')
      
      console.log('ðŸ’¡ CrÃ©ation de l\'utilisateur M. Ndandoalfred...\n')
      
      // Hash du mot de passe "Secure01"
      const hashedPassword = await bcrypt.hash('Secure01', 12)
      
      // CrÃ©er l'utilisateur
      const newUser = await prisma.user.create({
        data: {
          id: crypto.randomUUID(),
          nom: 'NDANDO',
          prenom: 'Alfred',
          email: 'alfred.ndando@instrumelec.com',
          phone: '699425611',
          password: hashedPassword,
          role: 'responsable_logistique', // Ã€ ajuster selon le rÃ´le rÃ©el
          updatedAt: new Date(),
        }
      })
      
      console.log('âœ… Utilisateur crÃ©Ã© avec succÃ¨s :')
      console.log(`   Nom: ${newUser.nom}`)
      console.log(`   PrÃ©nom: ${newUser.prenom}`)
      console.log(`   Email: ${newUser.email}`)
      console.log(`   TÃ©lÃ©phone: ${newUser.phone}`)
      console.log(`   RÃ´le: ${newUser.role}`)
      console.log(`   Mot de passe: Secure01`)
      console.log(`\nðŸŽ‰ L'utilisateur peut maintenant se connecter avec :`)
      console.log(`   Identifiant: 699425611`)
      console.log(`   Mot de passe: Secure01`)
    }
  }
}

main()
  .catch((e) => {
    console.error('âŒ Erreur:', e)
    process.exit(1)
  })
  .finally(async () => {
    await prisma.$disconnect()
  })
