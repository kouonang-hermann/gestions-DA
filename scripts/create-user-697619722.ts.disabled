/**
 * Script pour crÃ©er l'utilisateur 697619722
 */

import { PrismaClient } from '@prisma/client'
import * as bcrypt from 'bcryptjs'
import crypto from 'crypto'

const prisma = new PrismaClient()

async function createUser() {
  console.log('\nğŸ‘¤ CrÃ©ation de l\'utilisateur 697619722...\n')

  try {
    // VÃ©rifier si l'utilisateur existe dÃ©jÃ 
    const existingUser = await prisma.user.findUnique({
      where: { phone: '+237697619722' }
    })

    if (existingUser) {
      console.log('âš ï¸  L\'utilisateur existe dÃ©jÃ !\n')
      console.log('ğŸ”§ RÃ©initialisation du mot de passe...\n')

      const newPassword = 'Temp123!'
      const hashedPassword = await bcrypt.hash(newPassword, 10)

      await prisma.user.update({
        where: { id: existingUser.id },
        data: { password: hashedPassword }
      })

      console.log('âœ… Mot de passe rÃ©initialisÃ© avec succÃ¨s!')
      console.log(`   Nouveau mot de passe: ${newPassword}`)
      console.log(`   Utilisateur: ${existingUser.prenom} ${existingUser.nom}`)
      console.log(`   TÃ©lÃ©phone: ${existingUser.phone}\n`)
      
      return
    }

    // CrÃ©er le nouveau mot de passe
    const password = 'Temp123!'
    const hashedPassword = await bcrypt.hash(password, 10)

    // CrÃ©er l'utilisateur
    const newUser = await prisma.user.create({
      data: {
        id: crypto.randomUUID(),
        nom: 'Utilisateur',
        prenom: 'Nouveau',
        phone: '+237697619722',
        password: hashedPassword,
        role: 'employe' as any,
        isAdmin: false,
        updatedAt: new Date()
      }
    })

    console.log('âœ… Utilisateur crÃ©Ã© avec succÃ¨s!\n')
    console.log('ğŸ“‹ Informations du compte:')
    console.log(`   ID: ${newUser.id}`)
    console.log(`   Nom: ${newUser.prenom} ${newUser.nom}`)
    console.log(`   TÃ©lÃ©phone: ${newUser.phone}`)
    console.log(`   Mot de passe: ${password}`)
    console.log(`   RÃ´le: ${newUser.role}`)
    console.log()
    console.log('âš ï¸  IMPORTANT:')
    console.log('   - L\'utilisateur doit changer ce mot de passe aprÃ¨s la premiÃ¨re connexion')
    console.log('   - TÃ©lÃ©phone de connexion: 697619722 (sans indicatif)')
    console.log('   - Ou avec indicatif: +237697619722')
    console.log()

  } catch (error) {
    console.error('\nâŒ ERREUR:', error)
    throw error
  } finally {
    await prisma.$disconnect()
  }
}

createUser()
  .then(() => {
    console.log('âœ… Script terminÃ© avec succÃ¨s')
    process.exit(0)
  })
  .catch((error) => {
    console.error('âŒ Script terminÃ© avec erreur:', error)
    process.exit(1)
  })
